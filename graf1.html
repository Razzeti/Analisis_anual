<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel de Control Financiero Anual</title>
    <!-- Incluyendo Tailwind CSS para un diseño moderno -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Incluyendo la librería Chart.js para los gráficos -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Adaptador de fechas para Chart.js para manejar correctamente los meses -->
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <!-- Usando la fuente Inter de Google Fonts para una mejor tipografía -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        /* Define un tamaño base para los contenedores de los gráficos para que sean responsivos */
        .chart-container { position: relative; height: 45vh; width: 100%; }
        /* Estilos para el modo oscuro */
        .dark body { background-color: #0f172a; color: #e2e8f0; }
        .dark .card { background-color: #1e293b; border-color: #334155; }
        .dark .text-header { color: #f8fafc; }
        .dark .text-subheader { color: #94a3b8; }
    </style>
</head>
<body class="bg-gray-50 text-gray-800 transition-colors duration-300">

    <div class="container mx-auto p-4 md:p-8">
        <header class="mb-8 flex justify-between items-center">
            <div>
                <h1 class="text-3xl md:text-4xl font-bold text-header text-gray-900">Análisis Financiero Anual</h1>
                <p class="text-md text-subheader text-gray-600 mt-2">Un resumen visual y detallado de tu reporte consolidado.</p>
            </div>
        </header>

        <!-- Resumen de Métricas Clave -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
            <div class="card bg-white p-6 rounded-2xl shadow-lg border border-gray-200">
                <h2 class="text-lg font-semibold text-subheader">Ingresos Totales (Abonos)</h2>
                <p id="totalIngresos" class="text-3xl font-bold text-emerald-500 mt-2">S/ 0.00</p>
            </div>
            <div class="card bg-white p-6 rounded-2xl shadow-lg border border-gray-200">
                <h2 class="text-lg font-semibold text-subheader">Gastos Totales (Cargos)</h2>
                <p id="totalGastos" class="text-3xl font-bold text-red-500 mt-2">S/ 0.00</p>
            </div>
            <div class="card bg-white p-6 rounded-2xl shadow-lg border border-gray-200">
                <h2 class="text-lg font-semibold text-subheader">Balance Neto</h2>
                <p id="balanceNeto" class="text-3xl font-bold text-gray-700 mt-2">S/ 0.00</p>
            </div>
        </div>

        <!-- Gráficos Principales -->
        <div class="grid grid-cols-1 lg:grid-cols-5 gap-6">
            <!-- Gráfico de Evolución Mensual -->
            <div class="card bg-white p-6 rounded-2xl shadow-lg border border-gray-200 lg:col-span-3">
                <h3 class="text-xl font-semibold mb-4 text-header">Evolución Mensual</h3>
                <div class="chart-container">
                    <canvas id="evolucionMensualChart"></canvas>
                </div>
            </div>
            <!-- Gráfico de Proporción por Cuenta de Origen -->
            <div class="card bg-white p-6 rounded-2xl shadow-lg border border-gray-200 lg:col-span-2">
                <h3 class="text-xl font-semibold mb-4 text-header">Distribución por Cuenta</h3>
                <div class="chart-container flex items-center justify-center">
                    <canvas id="cuentaOrigenChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Gráficos de Top Transacciones -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mt-6">
            <div class="card bg-white p-6 rounded-2xl shadow-lg border border-gray-200">
                 <h3 class="text-xl font-semibold mb-4 text-header">Top 5 Orígenes de Ingresos</h3>
                 <div class="chart-container">
                     <canvas id="topIngresosChart"></canvas>
                 </div>
            </div>
            <div class="card bg-white p-6 rounded-2xl shadow-lg border border-gray-200">
                 <h3 class="text-xl font-semibold mb-4 text-header">Top 5 Destinos de Gastos</h3>
                 <div class="chart-container">
                     <canvas id="topGastosChart"></canvas>
                 </div>
            </div>
        </div>
    </div>

<script>
// --- 1. DATOS DE TRANSACCIONES ---
// ¡Importante! Aquí puedes pegar tu lista completa de transacciones.
// Por ahora, se usa una transacción ejemplar por mes como solicitaste.
const csvData = `FECHA;DESCRIPCION;CARGOS / DEBE;ABONOS / HABER;CUENTA_ORIGEN
01ENE;Saldo Anterior;0.0;1565.55;Yape
01ENE;Saldo Anterior;0.0;3578.87;Ahorro
01ENE;Pago YAPE de 19170;0.0;25.0;Yape
03ENE;WOW0020240762146;64.9;0.0;Yape
04ENE;Pago YAPE de 19370;0.0;24.0;Yape
04ENE;ABON PLIN-LIDIA EB *;0.0;10.0;Yape
04ENE;Pago YAPE de 19304;0.0;10.0;Yape
04ENE;Pago YAPE de 19403;0.0;10.0;Yape
05ENE;Pago YAPE de 19172;0.0;10.0;Yape
05ENE;CLAR000963438681;5.0;0.0;Yape
06ENE;Pago YAPE a 194967;20.0;0.0;Yape
07ENE;Pago YAPE de 21502;0.0;10.0;Yape
08ENE;Pago YAPE de 19107;0.0;10.0;Yape
09ENE;Pago YAPE de 19302;0.0;10.0;Yape
11ENE;Pago YAPE de 35598;0.0;25.0;Yape
11ENE;ABON PLIN-Luis Alb *;0.0;10.0;Yape
11ENE;Pago YAPE a 191711;28.0;0.0;Yape
11ENE;Pago YAPE de 19303;0.0;24.0;Yape
11ENE;Pago YAPE de 19475;0.0;25.0;Yape
11ENE;Pago YAPE de 19303;0.0;2.0;Yape
12ENE;Pago YAPE de 19100;0.0;25.0;Yape
12ENE;ABON PLIN-Tatiana *;0.0;27.0;Yape
15ENE;Pago YAPE a 194967;20.0;0.0;Yape
15ENE;PLIN-BRANCO ANTONY;10.0;0.0;Yape
16ENE;CLAR000963438681;5.0;0.0;Yape
18ENE;Pago YAPE de 53575;0.0;15.0;Yape
18ENE;Pago YAPE de 19496;0.0;15.0;Yape
19ENE;Pago YAPE de 19490;0.0;25.0;Yape
19ENE;ABON PLIN-WILSON E *;0.0;30.0;Yape
19ENE;Pago YAPE de 19198;0.0;30.0;Yape
19ENE;PLIN-BRANCO ANTONY;10.0;0.0;Yape
19ENE;Pago YAPE de 29594;0.0;30.0;Yape
19ENE;Pago YAPE de 19192;0.0;10.0;Yape
21ENE;Pago YAPE de 19172;0.0;235.0;Yape
22ENE;Pago YAPE de 36599;0.0;25.0;Yape
23ENE;Pago YAPE de 19179;0.0;28.0;Yape
23ENE;Pago YAPE de 31594;0.0;48.0;Yape
24ENE;Pago YAPE de 19137;0.0;10.0;Yape
24ENE;CLAR000963438681;5.0;0.0;Yape
24ENE;ABON PLIN-EDWIN LL *;0.0;40.0;Yape
24ENE;CLAR000991990346;5.0;0.0;Yape
25ENE;YAPE;80.0;0.0;Yape
25ENE;Pago YAPE a 191014;60.0;0.0;Yape
25ENE;Pago YAPE de 19475;0.0;20.0;Yape
25ENE;Pago YAPE de 19304;0.0;20.0;Yape
25ENE;Pago YAPE de 19304;0.0;18.0;Yape
25ENE;Pago YAPE a 194967;20.0;0.0;Yape
26ENE;Pago YAPE de 28002;0.0;10.0;Yape
27ENE;Pago YAPE a 191048;60.0;0.0;Yape
29ENE;Pago YAPE de 19195;0.0;10.0;Yape
29ENE;Pago YAPE de 31502;0.0;40.0;Yape
30ENE;Pago YAPE de 19403;0.0;20.0;Yape
30ENE;ABON PLIN-NATHALY *;0.0;12.0;Yape
30ENE;Pago YAPE de 49579;0.0;15.0;Yape
30ENE;Pago YAPE de 55005;0.0;10.0;Yape
30ENE;CLAR000963438681;5.0;0.0;Yape
31ENE;Pago YAPE de 19495;0.0;10.0;Yape
31ENE;PLIN-Jose Luis Gut;15.0;0.0;Yape
31ENE;Pago YAPE a 193777;15.0;0.0;Yape
31ENE;Pago YAPE de 19400;0.0;10.0;Yape
01FEB;Pago YAPE de 19106;0.0;10.0;Yape
01FEB;Pago YAPE de 19106;0.0;3.0;Yape
01FEB;Pago YAPE de 58502;0.0;30.0;Yape
01FEB;Pago YAPE de 19475;0.0;10.0;Yape
02FEB;WOW0020240762146;64.9;0.0;Yape
02FEB;Pago YAPE de 28574;0.0;10.0;Yape
04FEB;Pago YAPE de 20504;0.0;20.0;Yape
04FEB;Pago YAPE de 19475;0.0;20.0;Yape
06FEB;PLIN-BRANCO ANTONY;10.0;0.0;Yape
07FEB;Pago YAPE de 35573;0.0;10.0;Yape
07FEB;Pago YAPE de 28073;0.0;10.0;Yape
07FEB;Pago YAPE de 37098;0.0;10.0;Yape
07FEB;Pago YAPE de 19192;0.0;36.0;Yape
07FEB;Pago YAPE de 57078;0.0;45.0;Yape
07FEB;CLAR000963438681;5.0;0.0;Yape
07FEB;CLAR000940708423;5.0;0.0;Yape
08FEB;Pago YAPE a 193931;20.0;0.0;Yape
08FEB;Pago YAPE de 19196;0.0;20.0;Yape
08FEB;Pago YAPE de 19139;0.0;10.0;Yape
08FEB;ABON PLIN-WILSON N *;0.0;25.0;Yape
08FEB;Pago YAPE a 191992;33.0;0.0;Yape
08FEB;Pago YAPE a 193922;23.0;0.0;Yape
08FEB;Pago YAPE de 19479;0.0;116.0;Yape
08FEB;Pago YAPE de 33592;0.0;24.0;Yape
08FEB;Pago YAPE a 193922;2.0;0.0;Yape
09FEB;Pago YAPE de 21504;0.0;30.0;Yape
11FEB;Pago YAPE de 19103;0.0;15.0;Yape
11FEB;Pago YAPE de 22004;0.0;16.0;Yape
11FEB;RETIRO EFECTIVO;500.0;0.0;Ahorro
11FEB;Pago YAPE de 19195;0.0;18.0;Yape
11FEB;Pago YAPE de 19138;0.0;10.0;Yape
12FEB;Pago YAPE de 19479;0.0;300.0;Yape
13FEB;Pago YAPE a 191992;33.0;0.0;Yape
14FEB;Pago YAPE de 51378;0.0;24.0;Yape
14FEB;Pago YAPE de 19131;0.0;20.0;Yape
14FEB;Pago YAPE a 194967;30.0;0.0;Yape
15FEB;Pago YAPE de 19378;0.0;15.0;Yape
15FEB;CLAR000963438681;5.0;0.0;Yape
16FEB;Pago YAPE a 193922;4.5;0.0;Yape
16FEB;Pago YAPE de 35594;0.0;48.0;Yape
18FEB;Pago YAPE de 19194;0.0;46.0;Yape
18FEB;ABON PLIN-BENJAMIN *;0.0;100.0;Yape
18FEB;Pago YAPE de 19321;0.0;20.0;Yape
18FEB;Pago YAPE de 19495;0.0;15.0;Yape
19FEB;Pago YAPE de 19375;0.0;28.0;Yape
19FEB;ABON PLIN-Roxana D *;0.0;15.0;Yape
19FEB;Pago YAPE de 19194;0.0;24.0;Yape
20FEB;CLAR000963438681;5.0;0.0;Yape
20FEB;TRAN.CEL.BM.;0.0;52.0;Yape
20FEB;Pago YAPE a 570922;200.0;0.0;Yape
20FEB;Pago YAPE de 19239;0.0;30.0;Yape
20FEB;Pago YAPE de 19405;0.0;15.0;Yape
20FEB;Pago YAPE de 19405;0.0;35.0;Yape
21FEB;Pago YAPE a 570922;200.0;0.0;Yape
21FEB;Pago YAPE a 191972;228.0;0.0;Yape
21FEB;Pago YAPE de 19170;0.0;30.0;Yape
22FEB;Pago YAPE de 19195;0.0;15.0;Yape
22FEB;Pago YAPE a 194010;110.0;0.0;Yape
23FEB;Giro/Retiro de efe;20.0;0.0;Yape
23FEB;Pago YAPE de 19192;0.0;30.0;Yape
23FEB;ABON PLIN-MILAGROS *;0.0;25.0;Yape
23FEB;Pago YAPE de 19491;0.0;20.0;Yape
23FEB;Pago YAPE de 19399;0.0;25.0;Yape
25FEB;Pago YAPE a 194967;10.0;0.0;Yape
26FEB;Pago YAPE a 191004;200.0;0.0;Yape
26FEB;CLAR000991990346;5.0;0.0;Yape
26FEB;Pago YAPE de 19478;0.0;25.0;Yape
26FEB;CLAR000963438681;6.0;0.0;Yape
27FEB;Pago YAPE a 194967;20.0;0.0;Yape
28FEB;Pago YAPE de 57578;0.0;60.0;Yape
28FEB;Pago YAPE de 19394;0.0;25.0;Yape
01MAR;Pago YAPE de 19398;0.0;30.0;Yape
01MAR;CLAR000963438681;5.0;0.0;Yape
01MAR;Pago YAPE de 25536;0.0;18.0;Yape
02MAR;Pago YAPE de 19301;0.0;30.0;Yape
02MAR;Pago YAPE de 19179;0.0;25.0;Yape
02MAR;WOW0020240762146;64.9;0.0;Yape
03MAR;UNIV000075432353;55.0;0.0;Yape
04MAR;Pago YAPE de 55074;0.0;27.0;Yape
04MAR;Pago YAPE de 19197;0.0;17.0;Yape
04MAR;Pago YAPE de 44098;0.0;30.0;Yape
04MAR;TRAN.CEL.BM.;0.0;15.0;Yape
05MAR;PLIN-Jose Luis Gut;15.0;0.0;Yape
05MAR;Pago YAPE de 56005;0.0;15.0;Yape
05MAR;Pago YAPE a 191006;10.0;0.0;Yape
06MAR;Pago YAPE de 19496;0.0;25.0;Yape
06MAR;CLAR000963438681;5.0;0.0;Yape
06MAR;Pago YAPE a 192943;390.0;0.0;Yape
06MAR;Pago YAPE a 570005;106.0;0.0;Yape
06MAR;TRAN.CEL.BM.;0.0;23.0;Yape
06MAR;Pago YAPE a 570799;156.0;0.0;Yape
07MAR;Pago YAPE a 191002;15.0;0.0;Yape
07MAR;Pago YAPE a 191985;92.0;0.0;Yape
07MAR;Pago YAPE de 44596;0.0;25.0;Yape
07MAR;Pago YAPE de 39090;0.0;25.0;Yape
08MAR;Pago YAPE a 193756;30.9;0.0;Yape
09MAR;Pago YAPE de 41591;0.0;15.0;Yape
09MAR;Pago YAPE de 19439;0.0;30.0;Yape
09MAR;Pago YAPE de 43595;0.0;25.0;Yape
09MAR;Pago YAPE de 19170;0.0;30.0;Yape
09MAR;Pago YAPE de 48079;0.0;23.0;Yape
10MAR;CLAR000940708423;5.0;0.0;Yape
11MAR;Pago YAPE a 191981;7.5;0.0;Yape
11MAR;CLAR000991990346;5.0;0.0;Yape
12MAR;Pago YAPE de 19101;0.0;25.0;Yape
12MAR;Pago YAPE a 194967;20.0;0.0;Yape
13MAR;Pago YAPE de 19474;0.0;20.0;Yape
14MAR;Pago YAPE de 19301;0.0;20.0;Yape
14MAR;CLAR000963438681;5.0;0.0;Yape
14MAR;ABON PLIN-DARLENE *;0.0;50.0;Yape
15MAR;Pago YAPE de 19474;0.0;30.0;Yape
17MAR;Pago YAPE de 19172;0.0;15.0;Yape
17MAR;Pago YAPE a 194766;11.2;0.0;Yape
17MAR;Pago YAPE de 19199;0.0;4.0;Yape
18MAR;PITA050010091184;220.0;0.0;Ahorro
18MAR;CLAR000991990346;5.0;0.0;Yape
19MAR;Giro/Retiro de efe;400.0;0.0;Yape
20MAR;Pago YAPE de 19172;0.0;300.0;Yape
21MAR;Pago YAPE de 19172;0.0;9.0;Yape
21MAR;Pago YAPE de 19172;0.0;60.0;Yape
21MAR;Pago YAPE de 19172;0.0;60.0;Yape
22MAR;Giro/Retiro de efe;300.0;0.0;Yape
22MAR;CLAR000963438681;5.0;0.0;Yape
22MAR;Pago YAPE a 191919;25.0;0.0;Yape
22MAR;Pago YAPE de 19475;0.0;10.0;Yape
22MAR;TRAN.CEL.BM.;0.0;25.0;Yape
23MAR;Pago YAPE de 48595;0.0;10.0;Yape
23MAR;Pago YAPE de 19376;0.0;100.0;Yape
24MAR;Pago YAPE de 19171;0.0;10.0;Yape
24MAR;Pago YAPE a 194967;30.0;0.0;Yape
25MAR;Pago YAPE de 19102;0.0;15.0;Yape
25MAR;Pago YAPE de 19171;0.0;7.5;Yape
26MAR;Pago YAPE a 194928;3.0;0.0;Yape
26MAR;Pago YAPE a 191919;8.0;0.0;Yape
27MAR;Pago YAPE a 191340;38.0;0.0;Yape
27MAR;Pago YAPE a 194061;2.5;0.0;Yape
27MAR;Pago YAPE a 191704;100.0;0.0;Yape
27MAR;Pago YAPE a 191948;24.0;0.0;Yape
28MAR;Pago YAPE de 19138;0.0;20.0;Yape
28MAR;CLAR000963438681;5.0;0.0;Yape
28MAR;PITA050010091184;102.7;0.0;Ahorro
29MAR;Pago YAPE a 191065;180.0;0.0;Yape
29MAR;Pago YAPE a 193995;3.0;0.0;Yape
29MAR;Pago YAPE a 191065;30.0;0.0;Yape
29MAR;Pago YAPE a 011150;120.0;0.0;Yape
29MAR;Pago YAPE a 193058;6.5;0.0;Yape
29MAR;ABON PLIN-AURIA CR *;0.0;24.0;Yape
29MAR;Pago YAPE a 191252;130.0;0.0;Yape
29MAR;Giro/Retiro de efe;100.0;0.0;Yape
29MAR;Pago YAPE a 191017;20.0;0.0;Yape
30MAR;Pago YAPE a 194967;30.0;0.0;Yape
30MAR;CLAR000940708423;5.0;0.0;Yape
30MAR;WOW0020240762146;67.4;0.0;Yape
31MAR;Pago YAPE a 194928;3.0;0.0;Yape
31MAR;Pago YAPE de 19197;0.0;3.5;Yape
01ABR;Pago YAPE a 191919;8.0;0.0;Yape
01ABR;Pago YAPE a 191919;2.0;0.0;Yape
02ABR;Pago YAPE a 194928;3.0;0.0;Yape
02ABR;Pago YAPE de 19101;0.0;26.0;Yape
02ABR;Pago YAPE a 191388;10.0;0.0;Yape
02ABR;Pago YAPE de 19376;0.0;200.0;Yape
03ABR;Giro/Retiro de efe;400.0;0.0;Yape
04ABR;Pago YAPE a 193365;125.0;0.0;Yape
04ABR;Pago YAPE a 194705;19.0;0.0;Yape
04ABR;PLIN-Jose Luis Gut;15.0;0.0;Yape
04ABR;PLIN-JAIME SABBAGG;220.0;0.0;Yape
04ABR;Pago YAPE a 191039;22.0;0.0;Yape
05ABR;CLAR000963438681;5.0;0.0;Yape
05ABR;Pago YAPE a 194035;61.0;0.0;Yape
05ABR;Pago YAPE a 191909;110.0;0.0;Yape
05ABR;Pago YAPE a 191704;100.0;0.0;Yape
06ABR;MOVI000962007515;10.0;0.0;Yape
07ABR;ABON PLIN-MARIA GI *;0.0;30.0;Yape
07ABR;PLIN-MARIA GIL;30.0;0.0;Yape
07ABR;Pago YAPE de 19377;0.0;50.0;Yape
08ABR;Pago YAPE a 194967;30.0;0.0;Yape
08ABR;DE RED PERUANA DE *;0.0;500.0;Ahorro
08ABR;Pago YAPE a 194928;3.0;0.0;Yape
09ABR;PAGOEFECTIVO;14.16;0.0;Yape
09ABR;Pago YAPE de 19377;0.0;9.0;Yape
09ABR;Giro/Retiro de efe;50.0;0.0;Yape
11ABR;Pago YAPE a 191004;7.5;0.0;Yape
12ABR;Giro/Retiro de efe;50.0;0.0;Yape
12ABR;Pago YAPE de 19197;0.0;35.0;Yape
12ABR;PLIN-Jose Luis Gut;15.0;0.0;Yape
12ABR;CLAR000963438681;5.0;0.0;Yape
12ABR;Pago YAPE a 191925;7.0;0.0;Yape
12ABR;Pago YAPE a 191992;13.0;0.0;Yape
14ABR;Giro/Retiro de efe;100.0;0.0;Yape
14ABR;Pago YAPE a 194928;3.0;0.0;Yape
15ABR;Pago YAPE a 194928;3.0;0.0;Yape
15ABR;Pago YAPE de 22003;0.0;8.0;Yape
15ABR;Pago YAPE de 19376;0.0;19.0;Yape
16ABR;CLAR000963438681;5.0;0.0;Yape
16ABR;Pago YAPE a 194928;3.0;0.0;Yape
16ABR;Giro/Retiro de efe;500.0;0.0;Yape
18ABR;CLAR000940708423;5.0;0.0;Yape
19ABR;Pago YAPE a 194762;3.0;0.0;Yape
20ABR;Pago YAPE a 191025;27.0;0.0;Yape
21ABR;Pago YAPE a 193922;28.0;0.0;Yape
21ABR;TRAN.CEL.BM.;0.0;150.0;Yape
21ABR;Giro/Retiro de efe;100.0;0.0;Yape
21ABR;Pago YAPE a 194967;20.0;0.0;Yape
22ABR;Giro/Retiro de efe;100.0;0.0;Yape
22ABR;TRAN.CEL.BM.;14.8;0.0;Ahorro
23ABR;ESTACION AYLLU;30.0;0.0;Ahorro
23ABR;Pago YAPE a 194928;3.0;0.0;Yape
23ABR;CLAR000963438681;5.0;0.0;Yape
24ABR;Giro/Retiro de efe;50.0;0.0;Yape
24ABR;Pago YAPE a 194061;2.0;0.0;Yape
25ABR;Pago YAPE a 191901;1.5;0.0;Yape
25ABR;Pago YAPE a 194928;3.0;0.0;Yape
25ABR;Pago YAPE a 191069;10.0;0.0;Yape
26ABR;Pago YAPE a 191901;3.2;0.0;Yape
26ABR;Pago YAPE de 29597;0.0;8.0;Yape
26ABR;Pago YAPE de 43599;0.0;32.0;Yape
27ABR;CLAR000963438681;5.0;0.0;Yape
28ABR;Giro/Retiro de efe;500.0;0.0;Yape
28ABR;Pago YAPE a 191992;46.0;0.0;Yape
28ABR;Pago YAPE a 375924;3.0;0.0;Yape
29ABR;CLAR000940708423;5.0;0.0;Yape
30ABR;Pago YAPE de 19107;0.0;10.0;Yape
30ABR;Pago YAPE a 194928;3.0;0.0;Yape
30ABR;WOW0020240762146;67.4;0.0;Ahorro
30ABR;PITA050010091184;220.0;0.0;Ahorro
30ABR;Pago YAPE de 19107;0.0;200.0;Yape
30ABR;Giro/Retiro de efe;200.0;0.0;Yape
01MAY;Pago YAPE de 19376;0.0;120.0;Yape
02MAY;TRAN.CEL.BM.;420.0;0.0;Ahorro
02MAY;TRANSF.BCO.SCOTIAB;0.0;1591.25;Ahorro
02MAY;IMPUESTO ITF *;0.05;0.0;Ahorro
02MAY;TRAN.CEL.BM.;100.0;0.0;Ahorro
02MAY;TRAN.CEL.BM.;330.0;0.0;Ahorro
02MAY;Pago YAPE a 191392;10.0;0.0;Yape
02MAY;Pago YAPE a 194783;36.0;0.0;Yape
02MAY;Pago YAPE a 191992;13.0;0.0;Yape
02MAY;Pago YAPE a 194921;25.0;0.0;Yape
03MAY;E S PROCERES;23.72;0.0;Ahorro
03MAY;Giro/Retiro de efe;50.0;0.0;Yape
03MAY;Pago YAPE a 375924;3.0;0.0;Yape
03MAY;Giro/Retiro de efe;100.0;0.0;Yape
03MAY;CLAR000963438681;5.0;0.0;Yape
05MAY;TRAN.CTAS.TERC.BM;0.0;1120.0;Ahorro
05MAY;IMPUESTO ITF *;0.05;0.0;Ahorro
05MAY;Pago YAPE de 19104;0.0;500.0;Yape
05MAY;Pago YAPE de 19104;0.0;100.0;Yape
05MAY;Pago YAPE a 375924;3.0;0.0;Yape
06MAY;Pago YAPE a 194967;20.0;0.0;Yape
06MAY;Giro/Retiro de efe;200.0;0.0;Yape
07MAY;IMPUESTO ITF *;0.05;0.0;Ahorro
07MAY;TRAN.CTAS.TERC.BM;0.0;1170.0;Ahorro
07MAY;Pago YAPE a 191901;2.0;0.0;Yape
07MAY;Pago YAPE a 194928;3.0;0.0;Yape
07MAY;Pago YAPE a 191720;300.0;0.0;Yape
08MAY;Pago YAPE a 194928;3.0;0.0;Yape
09MAY;Pago YAPE a 194928;3.0;0.0;Yape
10MAY;CLAR000963438681;5.0;0.0;Yape
12MAY;Pago YAPE a 194740;72.0;0.0;Yape
12MAY;Pago YAPE a 375924;3.0;0.0;Yape
12MAY;IZI*ALTA VIDDA GAS;23.34;0.0;Ahorro
12MAY;Pago YAPE a 194061;2.0;0.0;Yape
13MAY;Pago YAPE de 19104;0.0;2.0;Yape
13MAY;Giro/Retiro de efe;200.0;0.0;Yape
13MAY;RETIRO EFECTIVO;600.0;0.0;Ahorro
15MAY;CLAR000963438681;5.0;0.0;Yape
16MAY;CLAR000940708423;5.0;0.0;Yape
16MAY;Pago YAPE a 194752;1.2;0.0;Yape
17MAY;Giro/Retiro de efe;100.0;0.0;Yape
17MAY;Pago YAPE a 191992;33.0;0.0;Yape
17MAY;Pago YAPE a 191351;12.5;0.0;Yape
17MAY;TRAN.CEL.BM.INTERB;50.0;0.0;Ahorro
18MAY;TRAN.CTAS.TERC.BM;0.0;500.0;Ahorro
18MAY;TRAN.CTAS.TERC.BM;0.0;400.0;Ahorro
19MAY;ABON PLIN-HELBERT *;0.0;4.0;Yape
20MAY;TRAN.CEL.BM.INTERB;20.0;0.0;Ahorro
20MAY;Pago YAPE a 375924;3.0;0.0;Yape
20MAY;CLAR000963438681;5.0;0.0;Yape
20MAY;Pago YAPE a 194971;10.0;0.0;Yape
20MAY;Pago YAPE a 194061;2.0;0.0;Yape
21MAY;Pago YAPE a 194061;2.0;0.0;Yape
22MAY;Giro/Retiro de efe;300.0;0.0;Yape
23MAY;Pago YAPE a 191053;11.0;0.0;Yape
23MAY;Pago YAPE de 19197;0.0;100.0;Yape
23MAY;Pago YAPE a 191992;26.0;0.0;Yape
23MAY;Pago YAPE a 191901;3.5;0.0;Yape
23MAY;Pago YAPE a 375924;3.0;0.0;Yape
24MAY;CLAR000963438681;5.0;0.0;Yape
24MAY;Pago YAPE a 191709;3.0;0.0;Yape
24MAY;Pago YAPE a 194769;18.2;0.0;Yape
24MAY;Pago YAPE de 19197;0.0;61.5;Yape
25MAY;RETIRO EFECTIVO;20.0;0.0;Ahorro
25MAY;Pago YAPE de 19197;0.0;26.0;Yape
25MAY;Pago YAPE a 191992;39.0;0.0;Yape
25MAY;Pago YAPE a 194967;20.0;0.0;Yape
26MAY;Giro/Retiro de efe;100.0;0.0;Yape
27MAY;Giro/Retiro de efe;500.0;0.0;Yape
27MAY;Pago YAPE a 375924;3.0;0.0;Yape
27MAY;Pago YAPE a 191994;17.5;0.0;Yape
28MAY;Pago YAPE a 194061;4.0;0.0;Yape
28MAY;CLAR000963438681;5.0;0.0;Yape
29MAY;TRAN.CEL.BM.;234.0;0.0;Ahorro
29MAY;TRAN.CEL.BM.;200.0;0.0;Ahorro
29MAY;TRAN.CTAS.TERC.BM;830.0;0.0;Ahorro
29MAY;Pago YAPE a 375924;3.0;0.0;Yape
29MAY;CLAR000940708423;5.0;0.0;Yape
29MAY;Pago YAPE a 191923;10.8;0.0;Yape
29MAY;Pago YAPE a 191041;24.0;0.0;Yape
29MAY;Pago YAPE a 194046;8.0;0.0;Yape
30MAY;Pago YAPE a 191004;10.0;0.0;Yape
30MAY;TRAN.CEL.BM.;0.0;484.0;Yape
30MAY;Pago YAPE de 19196;0.0;500.0;Yape
30MAY;Pago YAPE de 19196;0.0;500.0;Yape
30MAY;Pago YAPE a 191725;15.0;0.0;Yape
30MAY;Pago YAPE a 375924;3.0;0.0;Yape
31MAY;Giro/Retiro de efe;500.0;0.0;Yape
31MAY;Pago YAPE a 194767;32.0;0.0;Yape
31MAY;WOW0020240762146;67.4;0.0;Yape
31MAY;IMPUESTO ITF *;0.05;0.0;Ahorro
31MAY;Pago YAPE a 375924;3.0;0.0;Yape
31MAY;TRAN.CTAS.TERC.BM;1725.1;0.0;Ahorro
01JUN;Pago YAPE a 191700;4.0;0.0;Yape
01JUN;Pago YAPE a 191701;12.0;0.0;Yape
03JUN;IMPUESTO ITF *;0.05;0.0;Ahorro
03JUN;Pago YAPE de 19100;0.0;15.0;Yape
03JUN;PITA050010091184;220.0;0.0;Ahorro
03JUN;TRAN.CTAS.TERC.BM;0.0;1000.0;Ahorro
04JUN;CLAR000940708423;5.0;0.0;Yape
04JUN;Pago YAPE a 191720;95.0;0.0;Yape
04JUN;Pago YAPE a 191720;300.0;0.0;Yape
05JUN;Pago YAPE a 194061;4.0;0.0;Yape
06JUN;Pago YAPE a 191992;26.0;0.0;Yape
06JUN;Pago YAPE a 191992;13.0;0.0;Yape
07JUN;TRAN.CEL.BM.;323.0;0.0;Ahorro
09JUN;CLAR000963438681;5.0;0.0;Yape
10JUN;Pago YAPE de 19103;0.0;6.0;Yape
10JUN;Pago YAPE de 19197;0.0;30.0;Yape
10JUN;PLIN-Jose Luis Gut;50.0;0.0;Yape
10JUN;Pago YAPE a 191989;40.0;0.0;Yape
10JUN;Pago YAPE de 19100;0.0;23.5;Yape
10JUN;Pago YAPE a 194967;20.0;0.0;Yape
11JUN;Pago YAPE de 19377;0.0;500.0;Yape
11JUN;Pago YAPE de 19377;0.0;67.5;Yape
11JUN;CLAR000963438681;5.0;0.0;Yape
11JUN;Pago YAPE a 375924;3.0;0.0;Yape
11JUN;Pago YAPE de 19377;0.0;500.0;Yape
11JUN;Pago YAPE de 19377;0.0;500.0;Yape
13JUN;Pago YAPE a 194061;2.5;0.0;Yape
13JUN;Pago YAPE a 191941;11.0;0.0;Yape
13JUN;Pago YAPE a 191992;39.0;0.0;Yape
14JUN;IMPUESTO ITF *;0.05;0.0;Ahorro
14JUN;E S PROCERES;21.46;0.0;Ahorro
14JUN;TRAN.CTAS.TERC.BM;0.0;1260.0;Ahorro
14JUN;PLIN-Jose Luis Gut;73.0;0.0;Yape
15JUN;Pago YAPE a 191992;13.0;0.0;Yape
17JUN;Pago YAPE a 194061;4.0;0.0;Yape
17JUN;Pago YAPE a 193780;10.0;0.0;Yape
18JUN;TRAN.CTAS.TERC.BM;455.0;0.0;Ahorro
19JUN;ABON PLIN-CECILIA *;0.0;450.0;Yape
19JUN;ABON PLIN-CECILIA *;0.0;450.0;Yape
20JUN;Pago YAPE a 191069;10.0;0.0;Yape
20JUN;CLAR000963438681;5.0;0.0;Yape
22JUN;Pago YAPE a 191994;22.5;0.0;Yape
22JUN;Pago YAPE a 191992;13.0;0.0;Yape
22JUN;Pago YAPE de 19197;0.0;10.0;Yape
22JUN;CLAR000940708423;5.0;0.0;Yape
23JUN;Pago YAPE a 194967;10.0;0.0;Yape
24JUN;PLIN-Jose Luis Gut;30.0;0.0;Yape
24JUN;Pago YAPE a 194061;4.0;0.0;Yape
25JUN;TRAN.CTAS.TERC.BM;6100.0;0.0;Ahorro
25JUN;TRAN.CEL.BM.;15.0;0.0;Ahorro
25JUN;Pago YAPE a 191403;1.3;0.0;Yape
25JUN;PLIN-Jose Luis Gut;50.0;0.0;Yape
25JUN;Pago YAPE de 19107;0.0;500.0;Yape
25JUN;Pago YAPE de 19107;0.0;500.0;Yape
25JUN;Pago YAPE de 19107;0.0;500.0;Yape
25JUN;Pago YAPE de 19107;0.0;500.0;Yape
25JUN;Pago YAPE de 19100;0.0;6.0;Yape
25JUN;IMPUESTO ITF *;0.3;0.0;Ahorro
25JUN;CREDITO YAPE;0.0;200.0;Yape
26JUN;Pago YAPE a 375924;3.0;0.0;Yape
26JUN;TRAN.CEL.BM.;30.0;0.0;Ahorro
28JUN;Pago YAPE de 19107;0.0;100.0;Yape
28JUN;Pago YAPE de 19100;0.0;12.0;Yape
28JUN;Pago YAPE de 19197;0.0;3.0;Yape
28JUN;CLAR000940708423;5.0;0.0;Yape
28JUN;Pago YAPE de 19107;0.0;400.0;Yape
28JUN;Giro/Retiro de efe;500.0;0.0;Yape
29JUN;Pago YAPE de 19100;0.0;22.0;Yape
30JUN;Pago YAPE a 191919;10.0;0.0;Yape
30JUN;CLAR000963438681;5.0;0.0;Yape
30JUN;WOW0020240762146;67.4;0.0;Yape
30JUN;Pago YAPE a 194061;4.0;0.0;Yape
01JUL;Pago YAPE a 375924;3.0;0.0;Yape
01JUL;Pago YAPE a 191004;10.0;0.0;Yape
02JUL;Pago YAPE a 375924;3.0;0.0;Yape
03JUL;PITA050010091184;220.0;0.0;Yape
03JUL;Pago YAPE de 19107;0.0;200.0;Yape
03JUL;Pago YAPE a 375924;3.0;0.0;Yape
03JUL;Pago YAPE a 191901;4.4;0.0;Yape
05JUL;Pago YAPE de 19100;0.0;8.0;Yape
05JUL;CLAR000963438681;5.0;0.0;Yape
06JUL;Pago YAPE a 191992;39.0;0.0;Yape
07JUL;Pago YAPE de 19107;0.0;500.0;Yape
07JUL;Giro/Retiro de efe;500.0;0.0;Yape
07JUL;CLAR000940708423;5.0;0.0;Yape
08JUL;Pago YAPE a 375924;3.0;0.0;Yape
08JUL;Pago YAPE a 191038;4.5;0.0;Yape
09JUL;Pago YAPE a 375924;3.0;0.0;Yape
09JUL;Pago YAPE a 191941;10.0;0.0;Yape
09JUL;Pago YAPE de 19100;0.0;27.0;Yape
09JUL;Pago YAPE a 194967;20.0;0.0;Yape
10JUL;COBRO CREDITO YAPE;154.52;0.0;Yape
10JUL;COBRO CREDITO YAPE;51.79;0.0;Yape
10JUL;Pago YAPE de 19107;0.0;200.0;Yape
11JUL;Pago YAPE a 375924;3.0;0.0;Yape
11JUL;Pago YAPE a 191901;1.5;0.0;Yape
12JUL;Pago YAPE a 191994;8.5;0.0;Yape
13JUL;Pago YAPE a 191992;39.0;0.0;Yape
14JUL;Pago YAPE de 19101;0.0;140.0;Yape
14JUL;CLAR000914304199;5.0;0.0;Yape
15JUL;Giro/Retiro de efe;400.0;0.0;Yape
15JUL;Pago YAPE de 19100;0.0;39.5;Yape
15JUL;Pago YAPE de 19107;0.0;400.0;Yape
16JUL;Pago YAPE de 19197;0.0;10.0;Yape
17JUL;Pago YAPE a 194967;20.0;0.0;Yape
17JUL;Pago YAPE de 19377;0.0;500.0;Yape
17JUL;Pago YAPE de 19377;0.0;500.0;Yape
17JUL;Pago YAPE de 19377;0.0;500.0;Yape
18JUL;Pago YAPE de 19101;0.0;66.0;Yape
18JUL;CLAR000963438681;5.0;0.0;Yape
18JUL;Pago YAPE de 19121;0.0;113.0;Yape
19JUL;PLIN-Jose Luis Gut;35.0;0.0;Yape
21JUL;CLAR000940708423;5.0;0.0;Yape
21JUL;Pago YAPE a 194967;30.0;0.0;Yape
21JUL;Pago GOOGEL;462.5;0.0;Yape
22JUL;Pago YAPE de 19377;0.0;162.5;Yape
26JUL;CLAR000963438681;5.0;0.0;Yape
27JUL;Pago YAPE a 193083;15.0;0.0;Yape
27JUL;Pago YAPE a 191999;56.0;0.0;Yape
27JUL;MAPFRE PERU COMPAI;60.0;0.0;Ahorro
31JUL;Pago YAPE a 194967;20.0;0.0;Yape
31JUL;Pago YAPE de 19197;0.0;23.0;Yape
31JUL;TRAN.CEL.BM.;160.0;0.0;Ahorro
01AGO;Pago YAPE a 191041;22.0;0.0;Yape
01AGO;WOW0020240762146;67.4;0.0;Yape
01AGO;CLAR000963438681;5.0;0.0;Yape
04AGO;YQ-PH028 CHORRILL;19.8;0.0;Yape
05AGO;Pago YAPE a 191400;120.0;0.0;Yape
06AGO;Pago YAPE a 193793;10.0;0.0;Yape
06AGO;Premio Noble NL9PC;0.0;0.5;Yape
06AGO;YC-PAGO DE IMPUEST;40.0;0.0;Yape
07AGO;TRAN.CEL.BM.;300.0;0.0;Ahorro
07AGO;TRAN.CEL.BM.;247.0;0.0;Ahorro
07AGO;Pago YAPE a 191054;37.0;0.0;Yape
07AGO;Pago YAPE de 19107;0.0;100.0;Yape
07AGO;Pago YAPE de 19107;0.0;500.0;Yape
07AGO;PITA050010091184;220.0;0.0;Yape
07AGO;TRAN.CTAS.TERC.BM;566.8;0.0;Yape
09AGO;Pago YAPE a 191992;26.0;0.0;Yape
09AGO;CLAR000963438681;5.0;0.0;Yape
09AGO;Pago YAPE a 191947;10.0;0.0;Yape
10AGO;Pago YAPE a 191992;33.0;0.0;Yape
11AGO;Pago YAPE de 19104;0.0;2.0;Yape
13AGO;Pago YAPE a 194967;15.0;0.0;Yape
13AGO;Pago YAPE a 191191;6.0;0.0;Yape
14AGO;IMPUESTO ITF *;0.05;0.0;Ahorro
14AGO;TRANSF.BCO.INTERBA;0.0;1000.0;Ahorro
14AGO;ABON PLIN-CECILIA *;0.0;500.0;Yape
14AGO;ABON PLIN-CECILIA *;0.0;500.0;Yape
15AGO;Pago YAPE de 19106;0.0;3.4;Yape
15AGO;Pago YAPE a 194009;5.0;0.0;Yape
15AGO;Pago YAPE a 194767;3.4;0.0;Yape
15AGO;YC-PAGO DE IMPUEST;20.0;0.0;Yape
17AGO;Pago YAPE a 193786;12.0;0.0;Yape
17AGO;UNIV000075432353;55.0;0.0;Ahorro
18AGO;CLAR000963438681;5.0;0.0;Yape
20AGO;Pago YAPE a 193793;15.0;0.0;Yape
20AGO;YQ-PCG;15.0;0.0;Yape
20AGO;Google One;517.83;0.0;Ahorro
20AGO;YQ-KSK CINEMARK GA;32.5;0.0;Yape
21AGO;Pago YAPE de 19305;0.0;5.0;Yape
21AGO;Pago YAPE a 191963;7.0;0.0;Yape
21AGO;Pago GOOGEL;75.4;0.0;Yape
21AGO;Pago YAPE a 194967;20.0;0.0;Yape
22AGO;TRAN.CTAS.TERC.BM;986.8;0.0;Ahorro
22AGO;2008Google One *;0.0;517.83;Ahorro
25AGO;YQ-IZI*BOTICA SALU;3.5;0.0;Yape
25AGO;Pago YAPE a 375924;3.0;0.0;Yape
25AGO;Pago YAPE a 194098;10.0;0.0;Yape
25AGO;Pago YAPE a 192172;10.0;0.0;Yape
26AGO;UNIV000075432353;9.4;0.0;Ahorro
27AGO;Pago YAPE a 193782;7.8;0.0;Yape
27AGO;Pago YAPE a 194061;2.0;0.0;Yape
28AGO;CLAR000940708423;5.0;0.0;Yape
28AGO;Pago YAPE a 191919;10.0;0.0;Yape
28AGO;Pago YAPE a 191994;17.5;0.0;Yape
28AGO;Pago YAPE a 191901;3.5;0.0;Yape
28AGO;Pago YAPE de 19100;0.0;8.0;Yape
29AGO;Pago YAPE a 375924;3.0;0.0;Yape
29AGO;CLAR000963438681;5.0;0.0;Yape
29AGO;Pago YAPE a 191919;10.0;0.0;Yape
30AGO;E S PROCERES;22.33;0.0;Ahorro
30AGO;Pago YAPE de 19100;0.0;9.5;Yape
01SET;Pago YAPE a 194061;2.0;0.0;Yape
01SET;Pago YAPE a 194104;30.0;0.0;Yape
01SET;Pago YAPE a 192172;10.0;0.0;Yape
02SET;Pago YAPE de 19197;0.0;15.0;Yape
03SET;Pago YAPE a 375924;3.0;0.0;Yape
03SET;Pago YAPE a 191069;10.0;0.0;Yape
03SET;Pago YAPE a 194061;2.0;0.0;Yape
03SET;WOW0020240762146;67.4;0.0;Yape
04SET;Pago YAPE a 375924;3.0;0.0;Yape
04SET;TRAN.CEL.BM.;10.0;0.0;Ahorro
04SET;IMPUESTO ITF *;0.05;0.0;Ahorro
04SET;DEPOSITO EFECTIVO;0.0;1000.0;Ahorro
05SET;TRAN.CEL.BM.;10.0;0.0;Ahorro
05SET;CLAR000963438681;5.0;0.0;Yape
05SET;Pago YAPE a 191992;33.0;0.0;Yape
05SET;Pago YAPE a 375924;3.0;0.0;Yape
06SET;PITA050010091184;220.0;0.0;Ahorro
08SET;Pago YAPE a 375924;3.0;0.0;Yape
08SET;TRAN.CEL.BM.;10.0;0.0;Ahorro
08SET;Pago YAPE a 193793;10.0;0.0;Yape
09SET;CLAR000940708423;5.0;0.0;Yape
11SET;Pago YAPE a 194061;2.0;0.0;Yape
11SET;TRAN.CEL.BM.;10.0;0.0;Ahorro
11SET;TRAN.CEL.BM.;3.0;0.0;Ahorro
12SET;Pago YAPE de 19100;0.0;61.0;Yape
12SET;Pago YAPE de 19100;0.0;4.0;Yape
12SET;Pago YAPE a 375924;3.5;0.0;Yape
13SET;YC-PAGO DE IMPUEST;50.0;0.0;Yape
15SET;Pago YAPE a 375924;3.0;0.0;Yape
15SET;Pago YAPE a 191069;10.0;0.0;Yape
15SET;CLAR000963438681;5.0;0.0;Yape
16SET;Pago YAPE de 19197;0.0;20.0;Yape
17SET;Pago YAPE a 194061;2.5;0.0;Yape
17SET;Pago YAPE a 194104;30.0;0.0;Yape
18SET;Pago YAPE a 375924;3.0;0.0;Yape
18SET;Pago YAPE a 191069;10.0;0.0;Yape
19SET;TRAN.CEL.BM.;26.0;0.0;Ahorro
20SET;Google One;82.93;0.0;Ahorro
20SET;TRAN.CEL.BM.;26.0;0.0;Ahorro
22SET;Pago YAPE a 194737;5.2;0.0;Yape
22SET;Pago YAPE a 191780;10.0;0.0;Yape
24SET;CLAR000963438681;5.0;0.0;Yape
26SET;Giro/Retiro de efe;300.0;0.0;Yape
29SET;Pago YAPE de 19197;0.0;22.0;Yape
30SET;PLIN-PATRICIA JANE;21.0;0.0;Yape
30SET;CLAR000963438681;5.0;0.0;Yape
01OCT;Pago YAPE a 191340;6.0;0.0;Yape
01OCT;Pago YAPE a 194104;20.0;0.0;Yape
02OCT;WOW002024076214;69.9;0.0;Yape
02OCT;IMPUESTO ITF - LEY;0.15;0.0;Ahorro
02OCT;TRAN.CTAS.TERC.BM;0.0;3490.0;Ahorro
06OCT;CLAR000991990346;5.0;0.0;Yape
06OCT;Pago YAPE a 054888;20.0;0.0;Yape
09OCT;Pago YAPE a 194061;2.0;0.0;Yape
10OCT;Pago YAPE de 19100;0.0;10.0;Yape
11OCT;TRAN.CEL.BM.INTERB;10.0;0.0;Ahorro
11OCT;PLIN-JAQUELIN BENI;10.0;0.0;Yape
11OCT;TRAN.CTAS.TERC.BM;1714.0;0.0;Ahorro
12OCT;IMPUESTO ITF - LEY_________________;0.05;0.0;Ahorro
14OCT;Pago YAPE de 19197;8.0;0.0;Yape

`;

// --- 2. PROCESAMIENTO Y ANÁLISIS DE DATOS ---

// Función para convertir el texto CSV en un array de objetos
function parseCSV(data) {
    const lines = data.trim().split('\n');
    const headers = lines[0].split(';').map(h => h.trim());
    return lines.slice(1).map(line => {
        const values = line.split(';');
        let obj = {};
        headers.forEach((header, i) => {
            obj[header] = values[i] ? values[i].trim() : '';
        });
        return obj;
    });
}

// Mapeo de meses de español a inglés para que el constructor de fechas funcione universalmente
const mesesEs = { 'ENE': 'JAN', 'FEB': 'FEB', 'MAR': 'MAR', 'ABR': 'APR', 'MAY': 'MAY', 'JUN': 'JUN', 'JUL': 'JUL', 'AGO': 'AUG', 'SEP': 'SEP', 'OCT': 'OCT', 'NOV': 'NOV', 'DIC': 'DEC' };

// Procesamiento principal de cada transacción
const transacciones = parseCSV(csvData).map(t => {
    t.Gastos = parseFloat(t['CARGOS / DEBE']) || 0;
    t.Ingresos = parseFloat(t['ABONOS / HABER']) || 0;
    
    const fechaRaw = t.FECHA;
    const dia = fechaRaw.substring(0, 2);
    const mesAbbr = fechaRaw.substring(2, 5).toUpperCase();
    const mesEn = mesesEs[mesAbbr];
    const anio = 2025; // Año de referencia, se puede hacer dinámico si es necesario
    
    t.FechaObj = mesEn ? new Date(`${mesEn} ${dia}, ${anio}`) : null;
    return t;
}).filter(t => t.FechaObj);

// --- 3. CÁLCULOS PARA LAS MÉTRICAS Y GRÁFICOS ---

// Cálculo de totales para las tarjetas de resumen
const totalIngresos = transacciones.reduce((sum, t) => sum + t.Ingresos, 0);
const totalGastos = transacciones.reduce((sum, t) => sum + t.Gastos, 0);
const balanceNeto = totalIngresos - totalGastos;

// Formateador de moneda para Soles Peruanos
const formatoMoneda = (valor) => valor.toLocaleString('es-PE', { style: 'currency', currency: 'PEN' });

// Actualización de las tarjetas de resumen en el HTML
document.getElementById('totalIngresos').textContent = formatoMoneda(totalIngresos);
document.getElementById('totalGastos').textContent = formatoMoneda(totalGastos);
const balanceEl = document.getElementById('balanceNeto');
balanceEl.textContent = formatoMoneda(balanceNeto);
balanceEl.classList.toggle('text-emerald-500', balanceNeto >= 0);
balanceEl.classList.toggle('text-red-500', balanceNeto < 0);

// Agrupación de transacciones por mes
const mensual = {};
transacciones.forEach(t => {
    const month = t.FechaObj.toISOString().slice(0, 7); // Formato 'YYYY-MM'
    if (!mensual[month]) {
        mensual[month] = { ingresos: 0, gastos: 0 };
    }
    mensual[month].ingresos += t.Ingresos;
    mensual[month].gastos += t.Gastos;
});
const labelsMensual = Object.keys(mensual).sort();
const dataIngresosMensual = labelsMensual.map(m => mensual[m].ingresos);
const dataGastosMensual = labelsMensual.map(m => mensual[m].gastos);

// Agrupación por cuenta de origen
const porCuenta = transacciones.reduce((acc, t) => {
    const cuenta = t.CUENTA_ORIGEN || 'Desconocida';
    if (!acc[cuenta]) {
        acc[cuenta] = { total: 0 };
    }
    acc[cuenta].total += t.Ingresos + t.Gastos;
    return acc;
}, {});

// Función para agrupar y obtener el Top 5
function getTop5(data, descriptionField, amountField) {
    const grouped = data.filter(d => d[amountField] > 0).reduce((acc, curr) => {
        // Lógica para agrupar descripciones similares
        let key = curr[descriptionField];
        key = key.replace(/Pago YAPE (de|a) \d+/i, 'Pago YAPE a Terceros').trim();
        key = key.replace(/CLAR\d+/i, 'Servicios (Claro)').trim();
        key = key.replace(/WOW\d+/i, 'Suscripción (WOW)').trim();
        key = key.replace(/ABON PLIN-[\w\s\*]+/i, 'Recepción PLIN').trim();
        
        acc[key] = (acc[key] || 0) + curr[amountField];
        return acc;
    }, {});
    return Object.entries(grouped).sort(([,a],[,b]) => b - a).slice(0, 5);
}
const topIngresos = getTop5(transacciones, 'DESCRIPCION', 'Ingresos');
const topGastos = getTop5(transacciones, 'DESCRIPCION', 'Gastos');

// --- 4. RENDERIZADO DE GRÁFICOS ---
Chart.defaults.font.family = "'Inter', sans-serif";
Chart.defaults.color = '#64748b'; // Color de texto por defecto para los gráficos

new Chart(document.getElementById('evolucionMensualChart'), {
    type: 'line',
    data: {
        labels: labelsMensual,
        datasets: [
            { label: 'Ingresos', data: dataIngresosMensual, borderColor: '#10b981', backgroundColor: '#10b98130', fill: true, tension: 0.3, pointBackgroundColor: '#10b981' },
            { label: 'Gastos', data: dataGastosMensual, borderColor: '#ef4444', backgroundColor: '#ef444430', fill: true, tension: 0.3, pointBackgroundColor: '#ef4444' }
        ]
    },
    options: {
        responsive: true, maintainAspectRatio: false,
        scales: { 
            x: { type: 'time', time: { unit: 'month', displayFormats: { month: 'MMM yy' } } },
            y: { ticks: { callback: value => formatoMoneda(value) } }
        },
        plugins: { tooltip: { callbacks: { label: (context) => `${context.dataset.label}: ${formatoMoneda(context.parsed.y)}` } } }
    }
});

new Chart(document.getElementById('cuentaOrigenChart'), {
    type: 'doughnut',
    data: {
        labels: Object.keys(porCuenta),
        datasets: [{
            data: Object.values(porCuenta).map(c => c.total),
            backgroundColor: ['#38bdf8', '#fb923c', '#a78bfa'],
            borderColor: 'rgba(255, 255, 255, 0.1)',
            borderWidth: 4,
        }]
    },
    options: { 
        responsive: true, maintainAspectRatio: false, 
        plugins: { 
            legend: { position: 'bottom' },
            tooltip: { callbacks: { label: (context) => `${context.label}: ${formatoMoneda(context.parsed)}` } }
        } 
    }
});

new Chart(document.getElementById('topIngresosChart'), {
    type: 'bar',
    data: {
        labels: topIngresos.map(item => item[0]),
        datasets: [{
            label: 'Monto Total',
            data: topIngresos.map(item => item[1]),
            backgroundColor: '#10b98190',
            borderRadius: 4
        }]
    },
    options: { 
        indexAxis: 'y', responsive: true, maintainAspectRatio: false, 
        plugins: { legend: { display: false } },
        scales: { x: { ticks: { callback: value => formatoMoneda(value) } } }
    }
});

new Chart(document.getElementById('topGastosChart'), {
    type: 'bar',
    data: {
        labels: topGastos.map(item => item[0]),
        datasets: [{
            label: 'Monto Total',
            data: topGastos.map(item => item[1]),
            backgroundColor: '#ef444490',
            borderRadius: 4
        }]
    },
    options: { 
        indexAxis: 'y', responsive: true, maintainAspectRatio: false, 
        plugins: { legend: { display: false } },
        scales: { x: { ticks: { callback: value => formatoMoneda(value) } } }
    }
});
</script>
</body>
</html>
